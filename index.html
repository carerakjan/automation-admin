<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Automation Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="admin/public/css/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Loading Flat UI -->
    <link href="admin/public/css/flat-ui.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="admin/public/img/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.1/dragula.min.css">
    <link rel="stylesheet" href="admin/public/css/app/style.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
    <script src="admin/public/js/vendor/html5shiv.js"></script>
    <script src="admin/public/js/vendor/respond.min.js"></script>
    <![endif]-->

    <script src="/socket.io/socket.io.js"></script>
    <script data-main="admin/public/js/app/main" src="admin/public/js/vendor/require.min.js"></script>
  </head>

  <body>
    <nav id ="navbar-container" class="navbar navbar-default"></nav>
    <div id="main-container" class="container"></div>
    <div id="report-container" class="container"></div>
    <script>

      window.ss && $(function() {


        function onChangeAutomation(event) {
          if(event.target.checked) {
            useAutomation = true;
            $('#main-container').removeClass('disable');
          } else {
            useAutomation = false;
            $('#main-container').addClass('disable');
          }
        }

        function onSubmitForm(event) {

          var re = /^\s*(((ht|f)tp(s?))\:\/\/)?(www.|[a-zA-Z].)[a-zA-Z0-9\-\.]+\.([a-z]{2,6})(\:[0-9]+)*(\/($|[a-zA-Z0-9\.\,\;\?\'\\\+&amp;%\$#\=~_\-]+))*\s*$/;

          $('#report-container').empty();

          var data = {};
          data.url = $('#urlInput').val();
          var e = document.getElementById("platform");
          data.platform = e.options[e.selectedIndex].value;

          if(!data.url){
            alert('URL is required');
            return;
          } else if(!re.test(data.url)) {
            alert('URL validation error');
          }

          if(useAutomation) {
            var autoTests = $('#right-scripts .palette .item');

            if(autoTests.length) {

              [].forEach.call(autoTests, function(item) {
                !data.js && (data.js = []);
                data.js.push($(item).html());
              });

              if(data.js) {
                data.js = data.js.join('_');
              }
            }
          }

          $.ajax({
            type: "POST",
            url: '/run_bs',
            data: data,
            dataType: 'json'
          });

          return false;
        }







        function init() {
          $('#form-runBs').on('submit', onSubmitForm);
          $('#form-runBs button').on('click', onSubmitForm);
          $('#useAutomation').on('change', onChangeAutomation);


        }


      });


    </script>
    <div id="notifications" class="pallete-item"></div>
  </body>
</html>
